<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ù…ÛŒÙ†ÛŒâ€ŒØ§Ù¾Ù„ÛŒÚ©ÛŒØ´Ù† Ù…Ù†</title>
    <meta name="theme-color" content="#2c3e50"/>
    
    <!-- 1. Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯Ù† Ù„ÛŒÙ†Ú© Font Awesome Ø¨Ø±Ø§ÛŒ Ø¢ÛŒÚ©ÙˆÙ†â€ŒÙ‡Ø§ -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">

    <script src="https://miniapp.bale.ai/sdk.js"></script>
    
    <style>
        /* ÙÙˆÙ†Øª Ùˆ Ø§Ø³ØªØ§ÛŒÙ„ Ú©Ù„ÛŒ */
        body {
            font-family: Tahoma, "Arial Black", sans-serif;
            margin: 0;
            padding: 0;
            background-color: #ecf0f1; /* Ø±Ù†Ú¯ Ù¾Ø³â€ŒØ²Ù…ÛŒÙ†Ù‡ Ú©Ù…ÛŒ Ø±ÙˆØ´Ù†â€ŒØªØ± */
            color: #333;
            display: flex;
            flex-direction: column;
            height: 100vh;
            overflow: hidden;
        }

        /* Ù‡Ø¯Ø± (Header) */
        .header {
            background-color: #2c3e50; /* Ø¢Ø¨ÛŒ ØªÛŒØ±Ù‡/Ø³Ø±Ù…Ù‡â€ŒØ§ÛŒ */
            color: white;
            padding: 15px;
            text-align: center;
            box-shadow: 0 3px 6px rgba(0, 0, 0, 0.2);
        }
        .header h1 {
            margin: 0;
            font-size: 24px;
            font-weight: bold;
        }

        /* Ù…Ø­ØªÙˆØ§ (Content Area) */
        .content {
            flex-grow: 1;
            padding: 20px;
            overflow-y: auto;
            text-align: center;
        }

        .page {
            display: none;
        }
        .page.active {
            display: block;
        }
        .page-title {
            font-size: 26px;
            margin-bottom: 20px;
            color: #2980b9; /* Ø¢Ø¨ÛŒ Ø±ÙˆØ´Ù†â€ŒØªØ± Ø¨Ø±Ø§ÛŒ Ø¹Ù†ÙˆØ§Ù† */
            border-bottom: 2px solid #bdc3c7;
            padding-bottom: 5px;
        }
        .content-card {
            background-color: white;
            padding: 25px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
            text-align: right; /* ØªØ±Ø§Ø² Ù…Ø­ØªÙˆØ§ Ø¨Ù‡ Ø±Ø§Ø³Øª */
        }

        /* Ù†ÙˆØ§Ø± Ù†Ø§ÙˆØ¨Ø±ÛŒ Ù¾Ø§ÛŒÛŒÙ† (Bottom Navigation) - ØªØ±ØªÛŒØ¨ Ù…Ø¹Ú©ÙˆØ³ */
        .bottom-nav {
            display: flex;
            justify-content: space-around;
            background-color: white;
            border-top: 1px solid #ccc;
            padding: 5px 0;
            box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.15);
            width: 100%;
            direction: rtl; 
            /* **Ú†ÛŒÙ†Ø´ Ú©Ø§Ù…Ù„Ø§Ù‹ Ù…Ø¹Ú©ÙˆØ³ (Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø§ÙˆÙ„ØŒ Ø®Ø§Ù†Ù‡ Ø¢Ø®Ø±)** */
            flex-direction: row-reverse; 
        }
        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            color: #7f8c8d;
            cursor: pointer;
            padding: 8px 10px;
            transition: color 0.3s;
            font-size: 11px;
            flex: 1; /* Ø¨Ø±Ø§ÛŒ ØªÙˆØ²ÛŒØ¹ ÛŒÚ©Ø³Ø§Ù† ÙØ¶Ø§ */
        }
        .nav-item.active {
            color: #e74c3c; /* Ø±Ù†Ú¯ ØªØ§Ú©ÛŒØ¯ Ù‚Ø±Ù…Ø² Ø¨Ø±Ø§ÛŒ ÙØ¹Ø§Ù„ */
        }
        .nav-item i {
            font-size: 22px;
            margin-bottom: 4px;
        }
    </style>
</head>
<body>

    <!-- 1. Ù‡Ø¯Ø± -->
    <div class="header">
        <h1>Ù…Ø¯ÛŒØ±ÛŒØª Ù…ÛŒÙ†ÛŒâ€ŒØ§Ù¾Ù„ÛŒÚ©ÛŒØ´Ù†</h1>
    </div>

    <!-- 2. Ø¨Ø®Ø´ Ù…Ø­ØªÙˆØ§ -->
    <div class="content">
        
        <!-- ØµÙØ­Ù‡ Ø§ØµÙ„ÛŒ -->
        <div id="home-page" class="page active">
            <p class="page-title">Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯ Ø§ØµÙ„ÛŒ</p>
            <div class="content-card">
  <h3>Ø§Ú©Ø§Ù†Øªâ€ŒÙ‡Ø§</h3>

  if (!data.accounts || data.accounts.length === 0) {
  box.innerHTML = "<p>Ù‡ÛŒÚ† Ø§Ú©Ø§Ù†ØªÛŒ Ø«Ø¨Øª Ù†Ø´Ø¯Ù‡</p>";
  return;
}

  <button
    onclick="openAddAccount()"
    style="
      padding: 12px 20px;
      background:#3498db;
      color:white;
      border:none;
      border-radius:8px;
      font-size:15px;
      cursor:pointer;
    ">
    â• Ø§ÙØ²ÙˆØ¯Ù† Ø§Ú©Ø§Ù†Øª
  </button>

  <div id="accounts-list" style="margin-top:15px;"></div>
            </div>
        </div>

        <!-- ØµÙØ­Ù‡ Ø®Ø±ÛŒØ¯ -->
        <div id="shop-page" class="page">
            <p class="page-title">Ø¨Ø®Ø´ Ø®Ø±ÛŒØ¯</p>
            <div class="content-card">
                <h3>Ø§ÙØ²Ø§ÛŒØ´ Ù…Ù†Ø§Ø¨Ø¹</h3>
                <p>Ù…Ù†Ø§Ø¨Ø¹ Ù…ÙˆØ±Ø¯ Ù†ÛŒØ§Ø² (Ù…Ø§Ù†Ù†Ø¯ Ø§Ø¹ØªØ¨Ø§Ø± ÛŒØ§ Ø¯Ø³ØªØ±Ø³ÛŒ) Ø±Ø§ Ø§Ø² Ø§ÛŒÙ† Ø¨Ø®Ø´ ØªÙ‡ÛŒÙ‡ Ú©Ù†ÛŒØ¯.</p>
                <button style="padding: 10px 20px; background-color: #2ecc71; color: white; border: none; border-radius: 5px; cursor: pointer;">Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ù¾Ù„Ù†â€ŒÙ‡Ø§</button>
            </div>
        </div>

        <!-- ØµÙØ­Ù‡ ØªÙ†Ø¸ÛŒÙ…Ø§Øª -->
        <div id="settings-page" class="page">
            <p class="page-title">ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ú©Ø§Ø±Ø¨Ø±ÛŒ</p>
            <div class="content-card">
                <h4>ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø§ØµÙ„ÛŒ</h4>
                <ul>
                    <li>ØªØºÛŒÛŒØ± Ø±Ù…Ø² Ø¹Ø¨ÙˆØ±</li>
                    <li>Ù…Ø¯ÛŒØ±ÛŒØª ØªÙˆÚ©Ù†â€ŒÙ‡Ø§</li>
                    <li>ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ù†ÙˆØªÛŒÙÛŒÚ©ÛŒØ´Ù†</li>
                </ul>
            </div>
        </div>
        
        <!-- ØµÙØ­Ù‡ Ø§Ø·Ù„Ø§Ø¹Ø§Øª (Ø¬Ø¯ÛŒØ¯) -->
        <div id="info-page" class="page">
            <p class="page-title">ÙˆØ¶Ø¹ÛŒØª Ø³ÛŒØ³ØªÙ…</p>
            <div class="content-card">
                <h4>Ø¬Ø²Ø¦ÛŒØ§Øª ÙÙ†ÛŒ</h4>
                <p><strong>Ù†Ø³Ø®Ù‡ Ø§Ù¾Ù„ÛŒÚ©ÛŒØ´Ù†:</strong> 1.2.0</p>
                <p><strong>ÙˆØ¶Ø¹ÛŒØª Ø§ØªØµØ§Ù„:</strong> Ù…ØªØµÙ„ (Û² Ø³Ø±ÙˆØ± ÙØ¹Ø§Ù„)</p>
                <p>Ø¢Ø®Ø±ÛŒÙ† Ø¹Ù…Ù„ÛŒØ§Øª Ù…ÙˆÙÙ‚: 5 Ø¯Ù‚ÛŒÙ‚Ù‡ Ù¾ÛŒØ´.</p>
            </div>
        </div>
    </div>

    <!-- 3. Ù†ÙˆØ§Ø± Ù…Ù†ÙˆÛŒ Ù¾Ø§ÛŒÛŒÙ† - ØªØ±ØªÛŒØ¨ Ù…Ø¹Ú©ÙˆØ³ Ø§Ø¹Ù…Ø§Ù„ Ø´Ø¯Ù‡ Ø§Ø³Øª -->
    <div class="bottom-nav">
        
        <!-- ØªØ±ØªÛŒØ¨ HTML: 1. info, 2. settings, 3. shop, 4. home -->
        <!-- Ø¨Ù‡ Ø¯Ù„ÛŒÙ„ flex-direction: row-reverseØ› Ù†Ù…Ø§ÛŒØ´: 1. home, 2. shop, 3. settings, 4. info (Ø§Ø´ØªØ¨Ø§Ù‡) -->
        <!-- Ø§ØµÙ„Ø§Ø­: ØªØ±ØªÛŒØ¨ Ù†Ù…Ø§ÛŒØ´ Ø¯Ø± Ù†ÙˆØ§Ø± Ø¨Ø§ÛŒØ¯ Ø¨Ø§ ØªØ±ØªÛŒØ¨ Ø¯Ø±Ø®ÙˆØ§Ø³ØªÛŒ Ø´Ù…Ø§ (Ø§Ø·Ù„Ø§Ø¹Ø§ØªØŒ ØªÙ†Ø¸ÛŒÙ…Ø§ØªØŒ Ø®Ø±ÛŒØ¯ØŒ Ø®Ø§Ù†Ù‡) Ù…Ø·Ø§Ø¨Ù‚Øª Ø¯Ø§Ø´ØªÙ‡ Ø¨Ø§Ø´Ø¯ -->
        
        <!-- Ø¢ÛŒØªÙ… 1: ØµÙØ­Ù‡ Ø§ØµÙ„ÛŒ (Ø¯Ø± Ø³Ù…Øª Ú†Ù¾ Ù†Ù‡Ø§ÛŒÛŒ) -->
        <div class="nav-item" data-page="home-page">
            <i class="fas fa-house"></i>
            ØµÙØ­Ù‡ Ø§ØµÙ„ÛŒ
        </div>
        
        <!-- Ø¢ÛŒØªÙ… 2: ØµÙØ­Ù‡ Ø®Ø±ÛŒØ¯ -->
        <div class="nav-item" data-page="shop-page">
            <i class="fas fa-cart-shopping"></i>
            Ø®Ø±ÛŒØ¯
        </div>
        
        <!-- Ø¢ÛŒØªÙ… 3: ØµÙØ­Ù‡ ØªÙ†Ø¸ÛŒÙ…Ø§Øª -->
        <div class="nav-item" data-page="settings-page">
            <i class="fas fa-gear"></i>
            ØªÙ†Ø¸ÛŒÙ…Ø§Øª
        </div>
        
        <!-- Ø¢ÛŒØªÙ… 4: ØµÙØ­Ù‡ Ø§Ø·Ù„Ø§Ø¹Ø§Øª (Ø¯Ø± Ø³Ù…Øª Ø±Ø§Ø³Øª Ù†Ù‡Ø§ÛŒÛŒ) -->
        <div class="nav-item" data-page="info-page">
            <i class="fas fa-circle-info"></i>
            Ø§Ø·Ù„Ø§Ø¹Ø§Øª
        </div>
        
    </div>

    <script>
  document.addEventListener('DOMContentLoaded', () => {
  if (window.bale?.ready) {
    bale.ready();
  }, function () {
    const navItems = document.querySelectorAll('.nav-item');
    const pages = document.querySelectorAll('.page');

    function switchPage(pageId) {
      pages.forEach(p => p.classList.remove('active'));
      document.getElementById(pageId)?.classList.add('active');

      navItems.forEach(item => {
        item.classList.toggle(
          'active',
          item.getAttribute('data-page') === pageId
        );
      });
    }

    navItems.forEach(item => {
      item.addEventListener('click', () =>
        switchPage(item.getAttribute('data-page'))
      );
    });

    switchPage('home-page');
    loadAccounts();
  });

  function openAddAccount() {
    bale.showPopup({
      title: "Ø§ÙØ²ÙˆØ¯Ù† Ø§Ú©Ø§Ù†Øª",
      message: `
        <input id="phoneInput" placeholder="989xxxxxxxxx"
          style="width:100%;padding:10px;border-radius:6px;border:1px solid #ccc"/>
      `,
      buttons: [
        { text: "Ø§Ø±Ø³Ø§Ù„ Ú©Ø¯", type: "default", onClick: sendCodeFromPopup },
        { text: "Ù„ØºÙˆ", type: "cancel" }
      ]
    });
  }

  async function sendCodeFromPopup() {
    const phone = document.getElementById("phoneInput")?.value?.trim();

    if (!/^989\d{9}$/.test(phone)) {
      bale.showPopup({
        title: "âŒ Ø®Ø·Ø§",
        message: "Ø´Ù…Ø§Ø±Ù‡ ØªÙ„ÙÙ† Ù…Ø¹ØªØ¨Ø± Ù†ÛŒØ³Øª"
      });
      return;
    }

    try {
      const res = await fetch(
        "https://hunter-api-2x97.onrender.com/login/send-code",
        {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ phone })
        }
      );

      const data = await res.json();

      if (!data.ok) {
        throw new Error(data.error || "Ø§Ø±Ø³Ø§Ù„ Ú©Ø¯ Ù†Ø§Ù…ÙˆÙÙ‚ Ø¨ÙˆØ¯");
      }

      bale.showToast({ text: "Ú©Ø¯ Ø§Ø±Ø³Ø§Ù„ Ø´Ø¯" });
    
      askForCode(phone);
    } catch (err) {
      bale.showPopup({
        title: "âŒ Ø®Ø·Ø§",
        message: err.message
      });
    }
  }

  function askForCode(phone) {
    bale.showPopup({
      title: "Ú©Ø¯ ØªØ§ÛŒÛŒØ¯",
      message: `
        <input id="codeInput" placeholder="Ú©Ø¯ ØªØ§ÛŒÛŒØ¯"
          style="width:100%;padding:10px;border-radius:6px;border:1px solid #ccc"/>
      `,
      buttons: [
        { text: "ØªØ§ÛŒÛŒØ¯", type: "default", onClick: () => verifyCode(phone) },
        { text: "Ù„ØºÙˆ", type: "cancel" }
      ]
    });
  }

  async function verifyCode(phone) {
    const code = document.getElementById("codeInput")?.value?.trim();

    if (!code) {
      bale.showPopup({
        title: "âŒ Ø®Ø·Ø§",
        message: "Ú©Ø¯ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯"
      });
      return;
    }

    try {
      const res = await fetch(
        "https://hunter-api-2x97.onrender.com/login/verify-code",
        {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ phone, code })
        }
      );

      const data = await res.json();

      if (!data.ok) {
        throw new Error(data.error || "Ú©Ø¯ Ø§Ø´ØªØ¨Ø§Ù‡ Ø§Ø³Øª");
      }

      bale.showPopup({
        title: "âœ… Ù…ÙˆÙÙ‚",
        message: "Ø§Ú©Ø§Ù†Øª Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯"
      });

      loadAccounts();
    } catch (err) {
      bale.showPopup({
        title: "âŒ Ø®Ø·Ø§",
        message: err.message
      });
    }
  }

  async function loadAccounts() {
    try {
      const res = await fetch(
        "https://hunter-api-2x97.onrender.com/accounts"
      );
      const data = await res.json();

      const box = document.getElementById("accounts-list");
      box.innerHTML = "";

      data.accounts.forEach(acc => {
        const div = document.createElement("div");
        div.style =
          "padding:10px;margin-top:8px;background:#f4f4f4;border-radius:6px;";
        div.innerHTML = `
          ğŸ“± ${acc.phone}
          <span style="color:${acc.online ? 'green' : 'red'}">
            (${acc.online ? 'Ø¢Ù†Ù„Ø§ÛŒÙ†' : 'Ø¢ÙÙ„Ø§ÛŒÙ†'})
          </span>
        `;
        box.appendChild(div);
      });
    } catch {
      document.getElementById("accounts-list").innerHTML =
        "<p style='color:red'>Ø®Ø·Ø§ Ø¯Ø± Ø¯Ø±ÛŒØ§ÙØª Ø§Ú©Ø§Ù†Øªâ€ŒÙ‡Ø§</p>";
    }
  }
</script>

</body>
</html>
